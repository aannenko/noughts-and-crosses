<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Noughts&Crosses</title>
    <link rel="stylesheet" href="css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="css/bootstrap-theme.min.css"
          integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css" media="all"/>

    <script src="js/jquery-3.2.1.min.js" type="text/javascript"></script>
    <script src="js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>
    <script src="js/model.js" type="text/javascript"></script>
    <script src="js/view-model.js" type="text/javascript"></script>
    <script src="js/view.js" type="text/javascript"></script>
</head>

<script>
    let view = new View();
</script>

<body>
<header class="container-fluid col-md-12">
    <div class="text-center">
        <h2>Tic-Tac-Toe</h2>
        <button type="button" id="start_game" class="btn btn-success"
                onclick="startGame()">Start game!
        </button>
        <button type="button" id="start_button" class="btn btn-primary"
                onclick="window.location.reload()">Reload
        </button>
    </div>

</header>

<section class="container-fluid col-md-12 settings">
    <!--<p class="status">Players creation</p>-->
    <div class="col-md-12 field_settings_group center-block">
        <form class="form-inline">
            <div class="form-group field_settings rows">
                <label for="rowsInput">Rows</label>
                <button type="button" class="inc button" onclick="increaseRows()">+</button>
                <input type="text" class="form-control cell_count" id="rowsInput" value="" readonly>
                <button type="button" class="dec button" onclick="decreaseRows()">-</button>
            </div>
            <div class="form-group field_settings columns">
                <label for="columnsInput">Columns</label>
                <button type="button" class="inc button" onclick="increaseColumns()">+</button>
                <input type="text" class="form-control cell_count" id="columnsInput" value="" readonly>
                <button type="button" class="dec button" onclick="decreaseColumns()">-</button>
            </div>
            <div class="form-group field_settings winLength">
                <label for="winLengthInput">Winning length</label>
                <button type="button" class="inc button" onclick="increaseWinLength()">+</button>
                <input type="text" class="form-control cell_count" id="winLengthInput" value="" readonly>
                <button type="button" class="dec button" onclick="decreaseWinLength()">-</button>
            </div>
        </form>
    </div>

    <div class="col-md-12 players_settings">
        <form class="form-inline player_instance">
            <div class="form-group">
                <input title="" type="text" class="form-control player_name" value=""
                       onchange="updatePlayer(this, 'name')">
            </div>
            <div class="form-group">
                <select title="" class="form-control player_symbol"
                        onchange="updatePlayer(this, 'symbol')"></select>
            </div>
            <div class="checkbox">
                <label>
                    <input type="checkbox"> Is computer?
                </label>
            </div>
            <button type="submit" class="btn btn-default">Delete</button>
        </form>
        <br>
        <form class="form-inline player_instance">
            <div class="form-group">
                <input title="" type="text" class="form-control player_name" value=""
                       onchange="updatePlayer(this, 'name')">
            </div>
            <div class="form-group">
                <select title="" class="form-control player_symbol"
                        onchange="updatePlayer(this, 'symbol')"></select>
            </div>
            <div class="checkbox">
                <label>
                    <input type="checkbox"> Is computer?
                </label>
            </div>
            <button type="submit" class="btn btn-default">Delete</button>
        </form>
        <br>
        <button type="submit" class="btn btn-default">Add</button>
    </div>
</section>


<section class="container-fluid col-md-12 center-block game_field">
    <div class="center-block">
        <table id="play_field" class="table table-bordered"></table>
    </div>
</section>

<footer class="container-fluid col-md-12">
    <div class="text-center">
        <p class="status">Game status: <span id="gameStatus"></span></p>
    </div>
</footer>

</body>
<script>
    let playerInstance = document.getElementsByClassName('player_instance');
    let playerNameList = document.getElementsByClassName('player_name');
    let playerSymbolList = document.getElementsByClassName('player_symbol');
    let playerObjectList = view.getPlayerList();

    let rowsInput = document.getElementById('rowsInput');
    let columnsInput = document.getElementById('columnsInput');
    let winLengthInput = document.getElementById('winLengthInput');
    let inc = document.getElementsByClassName('inc');
    let dec = document.getElementsByClassName('dec');

    rowsInput.value = view.getRows();
    columnsInput.value = view.getColumns();
    winLengthInput.value = view.getWinLength();

    function increaseRows() {
        rowsInput.value = view.setRows(+rowsInput.value + 1);
    }

    function increaseColumns() {
        columnsInput.value = view.setColumns(+columnsInput.value + 1);
    }

    function increaseWinLength() {
        winLengthInput.value = view.setWinLength(+winLengthInput.value + 1);
    }

    function decreaseRows() {
        rowsInput.value = view.setRows(+rowsInput.value - 1);
    }
    function decreaseColumns() {
        columnsInput.value = view.setColumns(+columnsInput.value - 1);
    }
    function decreaseWinLength() {
        winLengthInput.value = view.setWinLength(+winLengthInput.value - 1);
    }

    function setAllPlayersId() {
        for (let i = 0; i < playerInstance.length; i++) {
            playerInstance[i].setAttribute('id', playerObjectList[i].id);
        }
    }

    function updatePlayer(el, prop) {
        let id = el.parentNode.parentNode.id;
        view.updatePlayer(id, prop, el.value);
        if (prop === 'symbol') {
            updateSymbolList();
        }
    }

    function getDefaultPlayerList() {
        for (let i = 0; i < view.getPlayerList().length; i++) {
            playerNameList[i].value = view.getPlayerList()[i].name;
            let option = new Option(view.getPlayerList()[i].symbol, view.getPlayerList()[i].symbol);
            playerSymbolList[i].appendChild(option);
            createSymbolList(playerSymbolList[i]);
        }
    }

    function createSymbolList(element) {
        let availableSymbolList = view.getAvailableSymbolList();
        let selected = element.options[element.selectedIndex];
        if (element.options.length > 1) {
            element.options.length = 0;
        }
        element.appendChild(selected);
        for (let k = 0; k < availableSymbolList.length; k++) {
            let option = new Option(availableSymbolList[k], availableSymbolList[k]);
            element.appendChild(option);
        }
    }

    function updateSymbolList() {
        for (let i = 0; i < playerSymbolList.length; i++) {
            createSymbolList(playerSymbolList[i]);
        }
    }

    function startGame() {
//        if (document.getElementById('play_field').hasChildNodes()) {
//            window.location.reload();
//        }
        view.init(view.getRows(rowsInput.value), view.getColumns(columnsInput.value));
    }

    window.onload = function() {
        setAllPlayersId();
        getDefaultPlayerList();
    };

</script>
</html>