<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>N&C</title>

    <link rel="stylesheet" href="css/style.css" media="all">
    <script type='text/javascript' src='js/knockout-3.4.2.js'></script>
    <script type='text/javascript' src='js/model.js'></script>

</head>

<body>
    <header>
        <div class="center" id="gameProcess">
            <button data-bind="click: function(){startGame()}">Start game!</button>
            <h2>Tic-Tac-Toe</h2>
            <button data-bind="click: function(){changeSettings()}">Settings</button>
        </div>
    </header>
    <section id="settings" class="visible">
        <div class="center">
            <div id="fieldSettings" class="cell-counter">
                <div class="rows">
                    <button id="increaseRowsBtn" data-bind="click: function(){increaseRows(), canAddPlayer()}, enable: isEnabled($data.rows, 'inc')">+
                        <span class="tip"></span>
                    </button>
                    <label>Rows</label>
                    <input data-bind="value: rows" type="text" readonly/>
                    <button id="decreaseRowsBtn" data-bind="click: function(){decreaseRows(), canAddPlayer()}, enable: isEnabled($data.rows, 'dec')">-
                        <span class="tip"></span>
                    </button>
                </div>
                <div class="columns">
                    <button id="increaseColumnsBtn" data-bind="click: function(){increaseColumns(), canAddPlayer()}, enable: isEnabled($data.columns, 'inc')">+
                        <span class="tip"></span>
                    </button>
                    <label>Columns</label>
                    <input data-bind="value: columns" type="text" readonly/>
                    <button id="decreaseColumnsBtn" data-bind="click: function(){decreaseColumns(), canAddPlayer()}, enable: isEnabled($data.columns, 'dec')">-
                        <span class="tip"></span>
                    </button>
                </div>
                <div class="winlength">
                    <button id="increaseWinLenBtn" data-bind="click: function(){increaseWinLength(), canAddPlayer()}, enable: isEnabled($data.winLength, 'incWinLen')">+
                        <span class="tip"></span>
                    </button>
                    <label>WinLength</label>
                    <input data-bind="value: winLength" type="text" readonly/>
                    <button id="decreaseWinLenBtn" data-bind="click: function(){decreaseWinLength(), canAddPlayer()}, enable: isEnabled($data.winLength, 'dec')">-
                        <span class="tip"></span>
                    </button>
                </div>
            </div>

            <div id="playerList">
                <div class="players-list" data-bind="foreach: players">
                    <div class="player_instance" data-bind="attr: {'id': id}">
                        <input data-bind="value: $data.name, event: {change: function(){$parent.updateName($data)}}" />
                        <div class="symbol">
                            <button class="symbol" data-bind="click: function(){$parent.visibilityControl($data.id, 'symbol')}">
                                <span data-bind="text: symbol"></span>
                            </button>
                            <ul class="symbol" data-bind="foreach: $parent.symbolsList, visible: symbolVisibility">
                                <li data-bind="text: $data, click: function(){$parents[1].updateSymbol($parent, $data)}">
                                    <img data-bind="" />
                                </li>
                            </ul>
                        </div>
                        <div class="type">
                            <button type="button" class="type" data-bind="click: function(){$parent.visibilityControl($data.id, 'type')}">
                                <span data-bind="text: type"></span>
                            </button>
                            <ul class="type" data-bind="foreach: $parent.typeList, visible: typeVisibility">
                                <li data-bind="text: $data, click: function(){$parents[1].updateType($parent, $data)}">
                                    <img data-bind="" />
                                </li>
                            </ul>
                        </div>
                        <button class="removePlayerBtn" type="button" data-bind="click: function(){$parent.removePlayer($data), canAddPlayer()}, enable: $parent.players().length > 2">Remove
                            <span class="tip">Add more players</span>
                        </button>
                    </div>
                </div>
                <button type="button" class="addBtn" id="addPlayerBtn" data-bind="click: function(){addPlayer(), canAddPlayer()}, enable: addEnabled()">Add player
                    <span class="tip"></span>
                </button>
            </div>
        </div>
    </section>

    <section id="playField" class="hidden">
        <div data-bind="template: {name: 'playFieldTemplate', foreach: playFieldObservable, as: 'cellRows'}"></div>
    </section>

    <footer id="status">
        <div class="center">
            <h2 id="gameStatus" class="">
                <span data-bind="text: status">Game status</span>
            </h2>
        </div>
    </footer>

    <script type="text/html" id="playFieldTemplate">
        <div class="flex_column">
            <div class="flex_column_item">
                <div class="flex_row" data-bind="template: {name: 'cellTemplate', foreach: cells, as: 'cell'}"></div>
            </div>
        </div>
    </script>

    <script type="text/html" id="cellTemplate">
        <div class="cell field_cell flex_row_item gray_bg" data-bind="attr: {id: cell.id}, 
                    click: function(){cell.cellClickEvent(), $root.getStatus()}"></div>
    </script>

    <script type='text/javascript' src='js/view-model.js'></script>
</body>
</html>